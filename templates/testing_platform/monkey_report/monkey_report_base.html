{% extends 'testing_platform/index.html' %}
{% load widget_tweaks %}

{% block left_bar %}
    {% include 'left_bar.html' with status_content='monkey_report' %}
{% endblock %}

{% block content_detail_header %}
    <div class="content-header">
        <div class="detail-header-nav">
            <ul class="content-ul-flex nav nav-pills">
                <li class="content-ul-li nav-item">
                    <a class="nav-link active" href="{% url 'monkey-report' car_name='ME5' %}">
                        <p>ME5</p>
                    </a>
                </li>
                <li class="content-ul-li nav-item">
                    <a class="nav-link" href="">
                        <p>ME7</p>
                    </a>
                </li>
            </ul>
        </div>
    </div>
{% endblock %}

{% block content_detail %}
    <form action="{% url 'monkey-report' car_name='ME5' %}" method="GET">
        <div class="detail-header-query">
            <div class="content-ul-flex">
                {% render_field test_version_query_object.start_time|add_label_class:'font-wide-title block' %}
                {% render_field test_version_query_object.start_time %}
                {% render_field test_version_query_object.end_time|attr:'type:date' %}
            </div>
            <div class="content-ul-flex">
                {% render_field test_version_query_object.mode_codes|add_label_class:'font-wide-title block' %}
                {% render_field test_version_query_object.mode_codes %}
            </div>
            <div class="content-ul-flex">
                {% render_field test_version_query_object.position|add_label_class:'font-wide-title block' %}
                {% render_field test_version_query_object.position %}
            </div>
        </div>
        <div>
            <input type="submit" value="查询" class="btn btn-primary btn-sm">
        </div>
    </form>
    <form action="#">
        <div class="detail-header-query">
            <div class="content-ul-flex">
                {% render_field test_version_object.test_versions|add_label_class:'font-wide-title block' %}
                {% render_field test_version_object.test_versions|add_class:'checkbox-all from-check-input' %}
                <div class="button-group-1">
                    <button class="button-font checkbox-all-b-i" type="button">全选</button>
                    <button class="button-font checkbox-all-b-o" type="button">清除</button>
                </div>
            </div>
            <div>
                <input type="submit" value="统计" class="btn btn-primary btn-sm">
            </div>
        </div>
    </form>

    <div class="report" id="monkey-report">
        <div class="report-col-stacked-chart" id="col-stacked-chart"></div>
    </div>
    <script type="text/javascript">
        var chart = echarts.init(document.getElementById('col-stacked-chart'))

        var reportTotal = {{ report_total_1|safe }}
{#        x 坐标 #}
        var testVersions = []
        var options = {}
        var series = []
        var errorKeys = []
        {#version: {errorKey1: [all version],}#}

        for (var testVersion in reportTotal) {
            testVersions.push(testVersion)
            for (var errorKey in reportTotal[testVersion]) {
                if (!options.hasOwnProperty(errorKey)) {
                    options[errorKey] = []
                    errorKeys.push(errorKey)
                }
                options[errorKey].push(reportTotal[testVersion][errorKey])
            }
        }
        for (var optionKey in options) {
            series.push(
                {
                    name: optionKey,
                    type: 'bar',
                    stack: 'error',
                    emphasis: {focus: 'series'},
                    data: options[optionKey]
                }
            )
        }

        var option = {
        tooltip: {
            trigger: 'axis',
            axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
            }
        },
        legend: {
            {#data: ['邮件营销', '联盟广告']#}
            data: errorKeys,
        },
        grid: {
            left: '5%',
            right: '5%',
            bottom: '3%',
            top: '20%',
            containLabel: true},
        xAxis: [{
                type: 'category',
                {#data: ['周一', '周二', '周三', '周四', '周五', '周六', '周日']}],#}
                data: testVersions,
                axisLabel: {
                    interval: 0,
                    rotate: 30
                }}],
        yAxis: [{type: 'value'}],
        series: series}

        chart.setOption(option)
    </script>
    <script>
        $('.checkbox-all-b-i').click(function (){
            $('.checkbox-all').attr('checked', true);});
        $('.checkbox-all-b-o').click(function (){
            $('.checkbox-all').removeAttr('checked');});
    </script>
{% endblock %}
